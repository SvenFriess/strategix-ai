<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Borgo Batone Chatbot â€“ Intern</title>
  <meta name="description" content="Interne Dokumentation fÃ¼r den Borgo Batone Bot (=B3): Betrieb, Konfiguration, Fixantworten, Backups, Incident-Handling." />
  <style>
    :root{
      --bg:#0b2530; --brand:#0e6ba8; --ink:#0d1b2a; --muted:#667a86; --paper:#fff;
      --card:#f2f7fa; --accent:#edf6ff; --ok:#0a7a46; --warn:#b98900; --err:#a1191a;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial,sans-serif;line-height:1.6;background:#fafafa;color:var(--ink)}
    header{background:var(--bg);color:#fff;padding:1.2rem}
    header h1{margin:0;font-size:1.9rem}
    header p{margin:.25rem 0 0;color:#cfe8f3}
    nav a{color:#cfe8f3;margin-right:1rem;text-decoration:none;font-weight:600}
    main{max-width:1000px;margin:2rem auto;padding:1.25rem;background:#fff;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,.08)}
    h2{color:var(--brand);margin-top:2rem}
    h3{color:var(--ink);margin-top:1.25rem}
    .grid{display:grid;gap:1rem;grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
    .card{background:var(--card);border-left:6px solid var(--brand);padding:1rem;border-radius:10px}
    .kbd{display:inline-block;padding:.15rem .4rem;border:1px solid #cbd5e1;border-bottom-width:2px;border-radius:6px;background:#f8fafc;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:.95em}
    code,pre{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
    pre{background:#0f172a;color:#e2e8f0;padding:1rem;border-radius:10px;overflow:auto}
    .badge{display:inline-block;padding:.15rem .5rem;border-radius:999px;background:var(--accent);color:#073b63;font-weight:700;font-size:.8rem;vertical-align:middle}
    .ok{color:var(--ok)} .warn{color:var(--warn)} .err{color:var(--err)}
    .table{width:100%;border-collapse:collapse;background:#fff;border:1px solid #e3e8ef;border-radius:10px;overflow:hidden}
    .table th,.table td{padding:.6rem .75rem;border-bottom:1px solid #e3e8ef;text-align:left}
    .table thead th{background:#f6fbff;color:#074e78}
    .small{font-size:.92rem;color:var(--muted)}
    footer{margin:2rem auto 1rem;text-align:center;color:var(--muted)}
    .callout{background:#fefae8;border-left:6px solid var(--warn);padding:.8rem 1rem;border-radius:10px}
    /* Umschalter Layout */
    .topnav{display:flex;justify-content:space-between;align-items:center;gap:1rem}
    .switcher a{color:#fff;text-decoration:none;font-weight:700;border:1px solid rgba(255,255,255,.35);padding:.35rem .6rem;border-radius:999px}
    .switcher a:hover{background:rgba(255,255,255,.08)}
  </style>
</head>
<body>
  <header>
    <h1>Borgo Batone Chatbot <span class="badge">Intern</span></h1>
    <p>Interne Seite fÃ¼r Mitwirkende (Betrieb, Pflege & Weiterentwicklung von B3).</p>
    <nav class="topnav">
      <div>
        <a href="wissen.html">Wissen</a>
        <a href="borgo-batone-chatbot.html">Ã–ffentliche Chatbot-Seite</a>
        <a href="borgo-batone-chatbot-intern.html">Intern</a>
      </div>
      <div class="switcher">
        ðŸ”€ <a href="borgo-batone-chatbot-nonit.html" aria-label="Zur non-IT Ansicht wechseln">Zur non-IT Ansicht</a>
      </div>
    </nav>
  </header>

  <main>
    <section class="grid">
      <div class="card">
        <h3>Steckbrief</h3>
        <ul>
          <li><strong>Name:</strong> B3 â€“ Borgo Batone Bot</li>
          <li><strong>KanÃ¤le:</strong> Signal-Gruppen (Trigger <span class="kbd">!Bot</span>)</li>
          <li><strong>Modelle:</strong> lokale LLMs via Ollama (z. B. <code>mistral:instruct</code>, <code>dolphin-phi</code>)</li>
          <li><strong>Compliance:</strong> DSGVO-konform, lokal betrieben</li>
        </ul>
      </div>
      <div class="card">
        <h3>System</h3>
        <ul>
          <li><strong>Host:</strong> Mac mini M4 (Prod), Mac mini M2 (Fallback)</li>
          <li><strong>Runtime:</strong> Python venv, <code>signal-cli</code>, Ollama</li>
          <li><strong>Repo:</strong> <code>~/Projekte/borgobatone.de-2</code></li>
          <li><strong>Fixed Q&A:</strong> <code>FIXED_RESPONSES.txt</code></li>
        </ul>
      </div>
      <div class="card">
        <h3>Gesundheitscheck</h3>
        <ul>
          <li>In Signal: <span class="kbd">!Bot ping</span> â†’ Erwartet â€žpongâ€œ/OK</li>
          <li>Funktionstest: <span class="kbd">!Bot wlan</span>, <span class="kbd">!Bot einkaufen</span>, <span class="kbd">!Bot Notfall</span></li>
        </ul>
      </div>
    </section>

    <h2>Schnellstart fÃ¼r Mitwirkende</h2>
    <ol>
      <li>In SIGNAL in die Testgruppe â€žBorgo-Bot TESTâ€œ posten (Trigger <span class="kbd">!Bot</span> nutzen).</li>
      <li>Fixantwort anpassen in <code>FIXED_RESPONSES.txt</code> (Format: <code>trigger => antwort</code>).</li>
      <li>Bot neu laden: Service stoppen/neu starten (siehe unten) oder Datei hot-reload, falls unterstÃ¼tzt.</li>
    </ol>

    <h2>Betrieb & Steuerung</h2>
    <h3>Start/Stop (Beispiel; Pfade ggf. anpassen)</h3>
    <pre># In venv / Projektverzeichnis
cd ~/Projekte/borgobatone.de-2
./stop_bot.sh || true
pkill -f "bot_v2.py" || true
pkill -f "signal-cli -u +4915755901211 -o json receive" || true
pkill -f "signal-cli -u +4915755901211 -o json receive -t" || true

# Startskript (falls vorhanden)
./start_bot.sh

# oder direkt (Beispiel):
source .venv/bin/activate
python bot_v2.py
    </pre>

    <h3>Konfiguration â€“ typische Parameter</h3>
    <ul>
      <li><strong>Trigger:</strong> <code>!Bot</code></li>
      <li><strong>Signal-Nummer:</strong> <code>+49 1575 5901211</code></li>
      <li><strong>Modelle:</strong> <code>mistral:instruct</code> (Standard), optional weitere Ã¼ber Ollama</li>
      <li><strong>Fixed-File:</strong> <code>FIXED_RESPONSES.txt</code> (Pfad im Log prÃ¼fen)</li>
    </ul>

    <h2>Backups</h2>
    <p>Empfohlen vor Ã„nderungen (Repo sichern, venv ausschlieÃŸen):</p>
    <pre># Timestamp & Ordner
TS=$(date +"%Y%m%d-%H%M%S")
BKDIR=~/Backups/borgobatone
mkdir -p "$BKDIR"

# Archiv erstellen (ohne .venv)
cd ~/Projekte
tar --exclude='borgobatone.de-2/.venv' -czf "$BKDIR/borgobatone.de-2-$TS.tar.gz" borgobatone.de-2
ls -lh "$BKDIR/borgobatone.de-2-$TS.tar.gz"
    </pre>

    <h2>Logs & Laufzeitdateien</h2>
    <table class="table">
      <thead>
        <tr>
          <th>Datei</th>
          <th>Funktion</th>
          <th>Hinweise</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>console.out</code></td>
          <td>Stdout/StdErr-Sammellog (Startmeldungen, einfache Prints/Fehler).</td>
          <td class="small">Gut fÃ¼r schnellen Ãœberblick nach Start/Crash.</td>
        </tr>
        <tr>
          <td><code>borgo-batone.log</code></td>
          <td>Anwendungslog des Bots (strukturierter, mit Timestamps & Leveln).</td>
          <td class="small">Bevorzugte Quelle fÃ¼r Fehlersuche im laufenden Betrieb.</td>
        </tr>
        <tr>
          <td><code>bot.pid</code></td>
          <td>PID-Datei des Hauptprozesses.</td>
          <td class="small">Zum sicheren Stoppen nutzen (z. B. <code>kill $(cat bot.pid)</code>).</td>
        </tr>
      </tbody>
    </table>

    <h2>Troubleshooting</h2>
    <ul>
      <li class="callout"><strong>Signal-Receiver kollidiert:</strong> Meldung â€žConfig file is in use by another instanceâ€œ. â†’ Alle <code>signal-cli â€¦ receive</code>-Prozesse beenden (siehe Stop-Block) und sauber neu starten.</li>
      <li><strong>Keine Antwort in Gruppen:</strong> PrÃ¼fen, ob <span class="kbd">!Bot</span>-Prefix gesetzt ist und der Bot in der Gruppe Mitglied ist.</li>
      <li><strong>LLM reagiert nicht:</strong> LÃ¤uft Ollama? Modell geladen? (<code>ollama list</code>, <code>ollama run</code> Test).</li>
      <li><strong>Fixantwort greift nicht:</strong> Schreibweise/Trigger exakt? Datei-Pfad im Log gegenprÃ¼fen.</li>
    </ul>

    <h2>Change-Management (Checkliste)</h2>
    <ol>
      <li>Backup erstellt (s. Abschnitt â€žBackupsâ€œ)?</li>
      <li>Ã„nderung in separatem Branch/Commit dokumentiert?</li>
      <li>Bot gestoppt & sauber neu gestartet?</li>
      <li>Smoke-Tests in â€žBorgo-Bot TESTâ€œ (<span class="kbd">ping</span>, <span class="kbd">wlan</span>, <span class="kbd">einkaufen</span>)?</li>
      <li>Release-Notiz im internen Channel?</li>
    </ol>

    <h2>Sicherheit & Datenschutz</h2>
    <ul>
      <li>Keine Weitergabe von Chatdaten an Drittserver; ausschlieÃŸlich lokale Verarbeitung.</li>
      <li>Logs auf personenbezogene Inhalte prÃ¼fen und ggf. pseudonymisieren.</li>
      <li>Zugriff auf Server/Signal-Account nur fÃ¼r autorisierte Mitwirkende.</li>
    </ul>

    <h2>Roadmap (Auszug)</h2>
    <ul>
      <li>RAG-Lite fÃ¼r interne Wissensdokumente</li>
      <li>Automatische Backups & Watchdog</li>
      <li>Feinere Rechte-/Rollensteuerung (Admin/Editor/Viewer)</li>
    </ul>
  </main>

  <footer>
    &copy; 2025 Borgo Batone Â· Strategix-AI Â· Interne Dokumentation â€“ Stand: 09.09.2025
  </footer>
</body>
</html>